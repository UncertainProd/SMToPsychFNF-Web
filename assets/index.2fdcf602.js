(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))c(i);new MutationObserver(i=>{for(const f of i)if(f.type==="childList")for(const l of f.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&c(l)}).observe(document,{childList:!0,subtree:!0});function a(i){const f={};return i.integrity&&(f.integrity=i.integrity),i.referrerpolicy&&(f.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?f.credentials="include":i.crossorigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function c(i){if(i.ep)return;i.ep=!0;const f=a(i);fetch(i.href,f)}})();function b(){}const Se=e=>e;function se(e,t){for(const a in t)e[a]=t[a];return e}function ce(e){return e()}function ae(){return Object.create(null)}function O(e){e.forEach(ce)}function fe(e){return typeof e=="function"}function j(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function Ee(e){return Object.keys(e).length===0}function de(e,...t){if(e==null)return b;const a=e.subscribe(...t);return a.unsubscribe?()=>a.unsubscribe():a}function $e(e,t,a){e.$$.on_destroy.push(de(t,a))}const pe=typeof window<"u";let Te=pe?()=>window.performance.now():()=>Date.now(),he=pe?e=>requestAnimationFrame(e):b;const M=new Set;function ve(e){M.forEach(t=>{t.c(e)||(M.delete(t),t.f())}),M.size!==0&&he(ve)}function Me(e){let t;return M.size===0&&he(ve),{promise:new Promise(a=>{M.add(t={c:e,f:a})}),abort(){M.delete(t)}}}function S(e,t){e.appendChild(t)}function L(e,t,a){e.insertBefore(t,a||null)}function A(e){e.parentNode.removeChild(e)}function E(e){return document.createElement(e)}function Oe(e){return document.createTextNode(e)}function C(){return Oe(" ")}function I(e,t,a,c){return e.addEventListener(t,a,c),()=>e.removeEventListener(t,a,c)}function Fe(e){return function(t){return t.preventDefault(),e.call(this,t)}}function y(e,t,a){a==null?e.removeAttribute(t):e.getAttribute(t)!==a&&e.setAttribute(t,a)}function Ne(e){return Array.from(e.childNodes)}function xe(e,t,a,c){a===null?e.style.removeProperty(t):e.style.setProperty(t,a,c?"important":"")}let z;function x(e){z=e}const N=[],le=[],B=[],oe=[],Ae=Promise.resolve();let G=!1;function ke(){G||(G=!0,Ae.then(me))}function U(e){B.push(e)}const q=new Set;let k=0;function me(){const e=z;do{for(;k<N.length;){const t=N[k];k++,x(t),Ce(t.$$)}for(x(null),N.length=0,k=0;le.length;)le.pop()();for(let t=0;t<B.length;t+=1){const a=B[t];q.has(a)||(q.add(a),a())}B.length=0}while(N.length);for(;oe.length;)oe.pop()();G=!1,q.clear(),x(e)}function Ce(e){if(e.fragment!==null){e.update(),O(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(U)}}const P=new Set;let Be;function J(e,t){e&&e.i&&(P.delete(e),e.i(t))}function ge(e,t,a,c){if(e&&e.o){if(P.has(e))return;P.add(e),Be.c.push(()=>{P.delete(e),c&&(a&&e.d(1),c())}),e.o(t)}else c&&c()}function ye(e){e&&e.c()}function Y(e,t,a,c){const{fragment:i,after_update:f}=e.$$;i&&i.m(t,a),c||U(()=>{const l=e.$$.on_mount.map(ce).filter(fe);e.$$.on_destroy?e.$$.on_destroy.push(...l):O(l),e.$$.on_mount=[]}),f.forEach(U)}function K(e,t){const a=e.$$;a.fragment!==null&&(O(a.on_destroy),a.fragment&&a.fragment.d(t),a.on_destroy=a.fragment=null,a.ctx=[])}function Pe(e,t){e.$$.dirty[0]===-1&&(N.push(e),ke(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Q(e,t,a,c,i,f,l,o=[-1]){const h=z;x(e);const d=e.$$={fragment:null,ctx:[],props:f,update:b,not_equal:i,bound:ae(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(h?h.$$.context:[])),callbacks:ae(),dirty:o,skip_bound:!1,root:t.target||h.$$.root};l&&l(d.root);let s=!1;if(d.ctx=a?a(e,t.props||{},(n,r,...u)=>{const p=u.length?u[0]:r;return d.ctx&&i(d.ctx[n],d.ctx[n]=p)&&(!d.skip_bound&&d.bound[n]&&d.bound[n](p),s&&Pe(e,n)),r}):[],d.update(),s=!0,O(d.before_update),d.fragment=c?c(d.ctx):!1,t.target){if(t.hydrate){const n=Ne(t.target);d.fragment&&d.fragment.l(n),n.forEach(A)}else d.fragment&&d.fragment.c();t.intro&&J(e.$$.fragment),Y(e,t.target,t.anchor,t.customElement),me()}x(h)}class X{$destroy(){K(this,1),this.$destroy=b}$on(t,a){if(!fe(a))return b;const c=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return c.push(a),()=>{const i=c.indexOf(a);i!==-1&&c.splice(i,1)}}$set(t){this.$$set&&!Ee(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const T=[];function Le(e,t=b){let a;const c=new Set;function i(o){if(j(e,o)&&(e=o,a)){const h=!T.length;for(const d of c)d[1](),T.push(d,e);if(h){for(let d=0;d<T.length;d+=2)T[d][0](T[d+1]);T.length=0}}}function f(o){i(o(e))}function l(o,h=b){const d=[o,h];return c.add(d),c.size===1&&(a=t(i)||b),o(e),()=>{c.delete(d),c.size===0&&(a(),a=null)}}return{set:i,update:f,subscribe:l}}function be(e){const t=e-1;return t*t*t+1}function ue(e){return Object.prototype.toString.call(e)==="[object Date]"}function V(e,t){if(e===t||e!==e)return()=>e;const a=typeof e;if(a!==typeof t||Array.isArray(e)!==Array.isArray(t))throw new Error("Cannot interpolate values of different type");if(Array.isArray(e)){const c=t.map((i,f)=>V(e[f],i));return i=>c.map(f=>f(i))}if(a==="object"){if(!e||!t)throw new Error("Object cannot be null");if(ue(e)&&ue(t)){e=e.getTime(),t=t.getTime();const f=t-e;return l=>new Date(e+l*f)}const c=Object.keys(t),i={};return c.forEach(f=>{i[f]=V(e[f],t[f])}),f=>{const l={};return c.forEach(o=>{l[o]=i[o](f)}),l}}if(a==="number"){const c=t-e;return i=>e+i*c}throw new Error(`Cannot interpolate ${a} values`)}function Ie(e,t={}){const a=Le(e);let c,i=e;function f(l,o){if(e==null)return a.set(e=l),Promise.resolve();i=l;let h=c,d=!1,{delay:s=0,duration:n=400,easing:r=Se,interpolate:u=V}=se(se({},t),o);if(n===0)return h&&(h.abort(),h=null),a.set(e=i),Promise.resolve();const p=Te()+s;let v;return c=Me(m=>{if(m<p)return!0;d||(v=u(e,l),typeof n=="function"&&(n=n(e,l)),d=!0),h&&(h.abort(),h=null);const g=m-p;return g>n?(a.set(e=l),!1):(a.set(e=v(r(g/n))),!0)}),c.promise}return{set:f,update:(l,o)=>f(l(i,e),o),subscribe:a.subscribe}}function je(e){let t,a,c,i,f,l,o;return{c(){t=E("div"),a=E("form"),a.innerHTML=`<div class="form-option svelte-ht7now"><label for="chartindex">Select Chart</label> 
            <select name="chartindex" id="chartindex"></select></div> 
        
        <div class="form-option svelte-ht7now"><label for="songname">Song Name</label> 
            <input type="text" name="songname" id="songname" class="svelte-ht7now"/></div> 

        <div class="form-option svelte-ht7now"><label for="songspeed">Song Speed</label> 
            <input type="number" name="songspeed" id="songspeed" min="0" max="1000" step="0.1" value="1" class="svelte-ht7now"/></div> 

        <div class="form-option svelte-ht7now"><label for="player1">Name of Player 1</label> 
            <input type="text" name="player1" id="player1" value="bf" class="svelte-ht7now"/></div> 

        <div class="form-option svelte-ht7now"><label for="player2">Name of Player 2</label> 
            <input type="text" name="player2" id="player2" value="dad" class="svelte-ht7now"/></div> 
        
        <div class="form-option svelte-ht7now"><label for="gfversion">gf version</label> 
            <input type="text" name="gfversion" id="gfversion" value="gf" class="svelte-ht7now"/></div> 
        
        <div class="flip-chart svelte-ht7now"><label for="flipchart">Flip chart</label> 
            <input type="checkbox" name="flipchart" id="flipchart"/> 
            <div class="svelte-ht7now">Note: dance-single + flip-chart = bf sings all the notes</div></div> 
        
        <button id="generate-chart" class="svelte-ht7now">Generate FNF Chart!</button>`,c=C(),i=E("button"),i.textContent="< Go Back",y(i,"id","back-button"),y(i,"class","svelte-ht7now"),y(t,"style",f=`opacity: ${e[1]}; transform: translateY(${-500*e[1]}px)`),y(t,"class","svelte-ht7now")},m(h,d){L(h,t,d),S(t,a),S(t,c),S(t,i),l||(o=[I(a,"submit",Fe(He)),I(i,"click",e[2])],l=!0)},p(h,[d]){d&2&&f!==(f=`opacity: ${h[1]}; transform: translateY(${-500*h[1]}px)`)&&y(t,"style",f)},i:b,o:b,d(h){h&&A(t),l=!1,O(o)}}}const He=e=>{};function Re(e,t,a){let c,i=b,f=()=>(i(),i=de(l,h=>a(1,c=h)),l);e.$$.on_destroy.push(()=>i());let{pos:l}=t;f();function o(h){l.set(0,{duration:400,easing:be})}return e.$$set=h=>{"pos"in h&&f(a(0,l=h.pos))},[l,c,o]}class De extends X{constructor(t){super(),Q(this,t,Re,je,j,{pos:0})}}function We(e){let t,a,c,i,f,l,o,h,d,s,n,r;return d=new De({props:{pos:e[1]}}),{c(){t=E("div"),a=E("h2"),a.textContent="Choose the Simfile you want to convert",c=C(),i=E("button"),i.textContent="Select *.sm file",f=C(),l=E("input"),h=C(),ye(d.$$.fragment),y(a,"class","svelte-q1c71s"),y(i,"class","svelte-q1c71s"),y(l,"type","file"),y(l,"name","fileupload"),y(l,"id","fileupload"),xe(l,"display","none"),y(t,"style",o=`position:relative; top:${-300*e[0]-150}px; opacity:${1-e[0]}`),y(t,"class","svelte-q1c71s")},m(u,p){L(u,t,p),S(t,a),S(t,c),S(t,i),S(t,f),S(t,l),L(u,h,p),Y(d,u,p),s=!0,n||(r=[I(i,"click",qe),I(l,"change",e[2])],n=!0)},p(u,[p]){(!s||p&1&&o!==(o=`position:relative; top:${-300*u[0]-150}px; opacity:${1-u[0]}`))&&y(t,"style",o)},i(u){s||(J(d.$$.fragment,u),s=!0)},o(u){ge(d.$$.fragment,u),s=!1},d(u){u&&A(t),u&&A(h),K(d,u),n=!1,O(r)}}}function qe(e){document.getElementById("fileupload").click()}function Ge(e,t,a){let c,i=Ie(0);$e(e,i,l=>a(0,c=l));function f(l){l.target.files[0].name.endsWith(".sm")&&i.set(1,{duration:400,easing:be})}return[c,i,f]}class Ue extends X{constructor(t){super(),Q(this,t,Ge,We,j,{})}}function Ve(e){let t,a,c;return a=new Ue({}),{c(){t=E("div"),ye(a.$$.fragment),y(t,"class","svelte-1gqq6jf")},m(i,f){L(i,t,f),Y(a,t,null),c=!0},p:b,i(i){c||(J(a.$$.fragment,i),c=!0)},o(i){ge(a.$$.fragment,i),c=!1},d(i){i&&A(t),K(a)}}}class ze extends X{constructor(t){super(),Q(this,t,null,Ve,j,{})}}new ze({target:document.getElementById("app")});(function(e){var t=function(){};t.cca=function(s,n){var r=s.charCodeAt(n);if(r==r)return r},t.substr=function(s,n,r){if(r==null)r=s.length;else if(r<0)if(n==0)r=s.length+r;else return"";return s.substr(n,r)},t.now=function(){return Date.now()};var a=function(s){s=i.cleanChart(l.trim(s));var n=s.split(":"),r=l.trim(n[0]).split(`
`);this.chartType=r[r.length-1];var r=l.trim(n[1]).split(`
`);this.author=r[r.length-1];var r=l.trim(n[2]).split(`
`);this.difficulty=r[r.length-1];var r=l.trim(n[3]).split(`
`);this.numericalMeter=r[r.length-1];var r=l.trim(n[4]).split(`
`);this.grooveRadarVal=r[r.length-1];for(var u=n[n.length-1],p=[],v=0,m=u.split(",");v<m.length;){var g=m[v];++v,p.push(l.trim(g))}this.measures=p,this.n_keys=l.trim(this.measures[0]).split(`
`)[0].length};a._cleanMetadata=function(s){var n=l.trim(s).split(`
`);return n[n.length-1]},a.prototype={toFNF:function(s,n,r){r==null&&(r=!1),n==null&&(n=0);var u=[],p=new h,v=0,m=0,g=i.bpmFromMap(s,m),_=!1,w=r;w==null&&(w=!1),u.push({sectionNotes:[],sectionBeats:4,typeOfSection:0,mustHitSection:w,gfSection:!1,bpm:g,changeBPM:_,altAnim:!1});for(var H=0,Z=this.measures;H<Z.length;){var ee=Z[H];++H;for(var te=l.trim(ee).split(`
`),R=0;R<te.length;){var ne=te[R];++R;var F=u[u.length-1];F.bpm=g;for(var re=0,_e=ne.length;re<_e;){var $=re++,ie=ne.charAt($);switch(ie){case"1":F.sectionNotes.push([(v-n)*1e3,$,0]);break;case"3":var D=p.h[$];D!=null?(D.push((v-n)*1e3-D[0]),p.remove($)):console.log("SMChart.hx:72:","[ERROR] Encountered tail "+ie+" with no head!");break;case"2":case"4":F.sectionNotes.push([(v-n)*1e3,$]),p.h[$]=F.sectionNotes[F.sectionNotes.length-1];break}}var we=4/l.trim(ee).split(`
`).length;m+=we;var W=i.bpmFromMap(s,m);if(W!=g){_=!0;var w=r;w==null&&(w=!1),u.push({sectionNotes:[],sectionBeats:4,typeOfSection:0,mustHitSection:w,gfSection:!1,bpm:W,changeBPM:_,altAnim:!1})}else _=!1;v=m*60/g,g=W}}return u},toString:function(){return""+this.chartType+" - "+this.difficulty+" - "+this.numericalMeter+" by "+this.author+" ("+this.n_keys+"k chart)"}};var c=function(s){this.bpms=[],this.charts=[],this.extraHeaderTags=new d,this._parseChart(s)};c.getOrDefault=function(s,n){return s==null?n:s},c.prototype={_parseChart:function(s){for(var n="",r=!1,u=0,p=s.length;u<p;){var v=u++,m=s.charAt(v);switch(m){case"#":r=!0;break;case";":r=!1;var g=i.parseEntry(n);if(!g.shouldParse){n="";continue}var _=g.tag;if(_==null)this.extraHeaderTags.h[g.tag]=g.value;else switch(_){case"BPMS":this.bpms=i.parseBPMStr(g.value);break;case"NOTES":this.charts.push(new a(g.value));break;case"OFFSET":this.chartOffset=parseFloat(g.value);break;case"TITLE":this.title=g.value;break;default:this.extraHeaderTags.h[g.tag]=g.value}n="";break;default:r&&(n+=m)}}},makeFNFChart:function(s,n,r){r==null&&(r=!1),s==null&&(s=0),n==null&&(n={});var u=n.song,p=n.speed,v=n.player1,m=n.player2,g=n.gfVersion,_={song:u==null?this.extraHeaderTags.h.TITLE:u,notes:[],events:[],bpm:this.bpms[0][1],needsVoices:!1,speed:p==null?1:p,player1:v==null?"bf":v,player2:m==null?"dad":m,gfVersion:g==null?"gf":g,stage:"",validScore:!0},w=this.charts[s].toFNF(this.bpms,this.chartOffset,r);return _.notes=_.notes.concat(w),{song:_}}};var i=function(){};i.parseBPMStr=function(s){var n=[];s=l.trim(s);for(var r=s.split(","),u=0;u<r.length;){var p=r[u];++u;var v=p.split("=");n.push([parseFloat(v[0]),parseFloat(v[1])])}return n.sort(function(m,g){return m[0]>g[0]?1:m[0]<g[0]?-1:0}),n},i.parseEntry=function(s){var n=l.trim(s).split(":"),r=n[0];if(i.TAGS_TO_INCLUDE.indexOf(r)==-1)return{shouldParse:!1,tag:r};var u;return n.length>2?u=n.slice(1).join(":"):u=n[1],l.endsWith(u,";")&&(u=u.substring(0,u.length-1)),{shouldParse:!0,tag:r,value:u}},i.getBeatsPerRow=function(s){return 4/l.trim(s).split(`
`).length},i.bpmFromMap=function(s,n){for(var r=0,u=s.length;r<u;){var p=r++;if(s[p][0]>n)return s[p-1][1]}return s[s.length-1][1]},i.makeSwagSection=function(s,n,r){return r==null&&(r=!1),{sectionNotes:[],sectionBeats:4,typeOfSection:0,mustHitSection:r,gfSection:!1,bpm:s,changeBPM:n,altAnim:!1}},i.cleanChart=function(s){for(var n="",r=!0,u=0,p=s.length;u<p;){var v=u++,m=s.charAt(v);m=="/"&&v+1<s.length&&s.charAt(v+1)=="/"?r=!1:m==`
`?(n+=m,r=!0):r&&(n+=m)}return n};var f=function(){};f.parseInt=function(s){if(s!=null)for(var n=0,r=s.length;n<r;){var u=n++,p=s.charCodeAt(u);if(p<=8||p>=14&&p!=32&&p!=45){var v=s.charCodeAt(u+1),m=parseInt(s,v==120||v==88?16:10);return isNaN(m)?null:m}}return null};var l=function(){};l.endsWith=function(s,n){var r=n.length,u=s.length;return u>=r?s.indexOf(n,u-r)==u-r:!1},l.isSpace=function(s,n){var r=t.cca(s,n);return r>8&&r<14?!0:r==32},l.ltrim=function(s){for(var n=s.length,r=0;r<n&&l.isSpace(s,r);)++r;return r>0?t.substr(s,r,n-r):s},l.rtrim=function(s){for(var n=s.length,r=0;r<n&&l.isSpace(s,n-r-1);)++r;return r>0?t.substr(s,0,n-r):s},l.trim=function(s){return l.ltrim(l.rtrim(s))},l.replace=function(s,n,r){return s.split(n).join(r)};var o=function(){};o.parseSMFile=function(s){for(s=l.replace(s,`\r
`,`
`),o.curSMFile=new c(s);o.chartselect.children.length>0;)o.chartselect.remove(0);for(var n=0,r=o.curSMFile.charts.length;n<r;){var u=n++,p=o.curSMFile.charts[u],v=window.document.createElement("option");v.value=""+u,v.innerText=p.toString(),o.chartselect.add(v)}o.songnameinput=window.document.getElementById("songname"),o.songnameinput.value=o.curSMFile.title,console.log("WebMain.hx:53:",o.curSMFile.title),console.log("WebMain.hx:54:",o.curSMFile.extraHeaderTags),console.log("WebMain.hx:55:",o.curSMFile.bpms),console.log("WebMain.hx:56:",o.curSMFile.chartOffset)},o.generateChart=function(s){var n={song:o.songnameinput.value!=""?o.songnameinput.value:"SMSong",speed:o.songspeedinput.value!=""?parseFloat(o.songspeedinput.value):1,player1:o.player1input.value!=""?o.player1input.value:"bf",player2:o.player2input.value!=""?o.player2input.value:"dad",gfVersion:o.gfversioninput.value!=""?o.gfversioninput.value:"gf"},r=o.curSMFile.makeFNFChart(f.parseInt(o.chartselect.value),n,o.flipchartinput.checked),u=new Blob([JSON.stringify(r,null,"	")],{type:"text/json"}),p=window.document.createElement("a");p.href=URL.createObjectURL(u),p.download=""+l.replace(n.song.toLowerCase()," ","-")+".json",window.document.body.appendChild(p),p.click(),window.document.body.removeChild(p)},o.handleFiles=function(s){o.thefiles=s.target.files;var n=o.thefiles.item(0),r=new FileReader;r.readAsText(n.slice()),r.onload=function(){o.parseSMFile(r.result)}},o.main=function(){console.log("WebMain.hx:94:","-------Welcome to the SM to JSON converter------"),o.simfileupload=window.document.getElementById("fileupload"),o.simfileupload.addEventListener("change",o.handleFiles,!1),o.generatechartbtn=window.document.getElementById("generate-chart"),o.generatechartbtn.addEventListener("click",o.generateChart,!1),o.chartselect=window.document.getElementById("chartindex"),o.songnameinput=window.document.getElementById("songname"),o.songspeedinput=window.document.getElementById("songspeed"),o.player1input=window.document.getElementById("player1"),o.player2input=window.document.getElementById("player2"),o.gfversioninput=window.document.getElementById("gfversion"),o.flipchartinput=window.document.getElementById("flipchart")};var h=function(){this.h={}};h.prototype={remove:function(s){return this.h.hasOwnProperty(s)?(delete this.h[s],!0):!1}};var d=function(){this.h=Object.create(null)};typeof performance<"u"&&typeof performance.now=="function"&&(t.now=performance.now.bind(performance)),i.TAG_START="#",i.TAG_END=";",i.TAG_SEP=":",i.TAGS_TO_INCLUDE=["TITLE","OFFSET","BPMS","STOPS","NOTES","ARTIST","CREDIT"],i.NOTE_NONE="0",i.NOTE_STEP="1",i.NOTE_HOLD_HEAD="2",i.NOTE_TAIL="3",i.NOTE_ROLL_HEAD="4",i.NOTE_MINE="M",i.BEATS_PER_MEASURE=4,o.main()})();
